---
import Stack from "../../lib/cms";
import MainLayout from "../../layouts/main.astro"
import Time from "../../components/time"
import ContentBlock from "../../components/content-block"

export async function getStaticPaths() {
  const entries = await Stack.getEntry({
    contentTypeUid: 'unit',
    referenceFieldPath: [
      'lessons',
      'lessons.activities'
    ]
  });

  const units = [];

  entries[0].map((unit) => {
    units.push({
      params: {unit: unit.url},
      props: unit
    });
  });

  return units;
}

const {title, lessons, grade_level, time_to_completion, intro, content} = Astro.props;
console.log(content);
---

<MainLayout title={title}>
  <div class="flex gap-4">
    <div class="w-2/3">
      <h1 class="text-5xl font-bold mb-4">{title}</h1>
      <div class="flex gap-8 flex-column md:flex-row mb-8">
        <div class="font-bold">Grade: {grade_level}</div>
        <div class="font-bold"><Time totalMinutes={time_to_completion} /></div>
      </div>
      <div class="text-xl text-gray-500">{intro}</div>
      <div>
        {content.map((block, index) => {
          return (
              <div class={index !== content.length - 1 ? 'mb-10' : ''}>
                  <ContentBlock block={block} />
              </div>
          )
        })}
      </div>
    </div>
    <div class="w-1/3 bg-gray-200">
      Sidebar!
    </div>
  </div>
  <div class="border-t border-gray-400 pt-12 mt-12">
    <h2>Lessons</h2>
    <ul>
      {lessons.map((lesson) => (
        <li><a href={`/lessons/${lesson.url}`}>{lesson.title}</a></li>
      ))}
    </ul>
  </div>
</MainLayout>



